<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RadioImagerGPU: CPU Implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RadioImagerGPU<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">CPU Implementation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md39"></a> </p>
<h2><a class="anchor" id="autotoc_md40"></a>
How to Execute</h2>
<p>To run the CPU implementation, execute the <code><a class="el" href="imaging__cpu_8py.html">imaging_cpu.py</a></code> script from the <code>python</code> directory: </p><div class="fragment"><div class="line">python3 python/imaging_cpu.py [OPTIONS]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md41"></a>
What the Code Does</h2>
<p>The <code><a class="el" href="imaging__cpu_8py.html">imaging_cpu.py</a></code> script computes UVW coordinates from XYZ coordinates, performs imaging using CPU processing, and saves the resulting images and coordinates.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Options</h2>
<p>The following options can be provided to the <code><a class="el" href="imaging__cpu_8py.html">imaging_cpu.py</a></code> script:</p>
<ul>
<li><code>--input</code>: Path to the input CSV file with XYZ coordinates. Default: <code>data/xyz_coordinates.csv</code></li>
<li><code>--directions</code>: Path to the directions CSV file with Hour Angles (HAs) and Declinations (Decs). Default: <code>data/directions.csv</code></li>
<li><code>--use_predefined_params</code>: Use predefined UVW parameters. Default: <code>true</code></li>
<li><code>--image_dir</code>: Directory to save images. Default: <code>data/images</code></li>
<li><code>--uvw_dir</code>: Directory to save UVW coordinates. Default: <code>data/uvw_coordinates</code></li>
<li><code>--optimized</code>: Use optimized implementation. Default: <code>true</code></li>
<li><code>--save_uvw</code>: Save UVW coordinates to CSV. Default: <code>true</code></li>
<li><code>--generate_images</code>: Generate and save images. Default: <code>true</code></li>
<li><code>--save_im</code>: Save images (default: true)</li>
<li><code>--save_as_csv</code>: Additionally save images as CSV files apart from PNG. Default: <code>true</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md43"></a>
Optimized vs. Non-Optimized Implementation</h2>
<h3><a class="anchor" id="autotoc_md44"></a>
Optimized Implementation</h3>
<p>The optimized implementation leverages NumPy's broadcasting and vectorized operations to efficiently compute the UVW coordinates and map visibilities to a grid. This approach minimizes the use of explicit loops and takes advantage of NumPy's internal optimizations for array operations, resulting in significant performance improvements, especially for large datasets.</p>
<ul>
<li><b>UVW Computation</b>:<ul>
<li>Uses broadcasting to compute the differences between XYZ coordinates.</li>
<li>Calculates UVW coordinates for all baselines.</li>
<li>Masks and flattens arrays to select relevant baselines.</li>
</ul>
</li>
<li><b>Visibility Mapping</b>:<ul>
<li>Uses vectorized operations to compute grid indices.</li>
<li>Employs <code>np.add.at</code> to accumulate visibilities on the grid efficiently.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md45"></a>
Non-Optimized Implementation</h3>
<p>The non-optimized implementation uses explicit loops to compute UVW coordinates and map visibilities to a grid. While this approach is straightforward and easier to understand, it is significantly slower for large datasets due to the overhead of Python loops and the lack of vectorized operations.</p>
<ul>
<li><b>UVW Computation</b>:<ul>
<li>Uses nested loops to compute the differences between XYZ coordinates for each pair of antennas.</li>
<li>Calculates UVW coordinates for each baseline individually.</li>
</ul>
</li>
<li><b>Visibility Mapping</b>:<ul>
<li>Uses loops to compute grid indices and accumulate visibilities.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md46"></a>
Example Command</h2>
<div class="fragment"><div class="line">python3 python/imaging_cpu.py --input data/xyz_coordinates.csv --directions data/directions.csv --use_predefined_params false --image_dir output/images --uvw_dir output/uvw --optimized false --save_uvw true --generate_images true --save_im true --save_as_csv true</div>
</div><!-- fragment --><p>This command will use custom input files, disable predefined UVW parameters, output UVW coordinates to the specified directory, and save images to the specified directory together with saving them as CSV files.</p>
<p>Got it. Here is the text to be added to your README without the code:</p>
<h1><a class="anchor" id="autotoc_md47"></a>
Additional Scripts</h1>
<h2><a class="anchor" id="autotoc_md48"></a>
Generating Synthetic Data</h2>
<p>The <code><a class="el" href="generate__synthetic__data_8py.html">generate_synthetic_data.py</a></code> script can be used to generate synthetic XYZ coordinates and directions for testing purposes. This script can be executed with the following command:</p>
<div class="fragment"><div class="line">python3 python/generate_synthetic_data.py</div>
</div><!-- fragment --><p>This generates synthetic data which can be used for testing with different configurations, such as:</p>
<div class="fragment"><div class="line">python3 python/imaging_cpu.py --input data/elements_25_directions_1/xyz_coordinates.csv --directions data/elements_25_directions_1/directions.csv --use_predefined_params true --image_dir data/elements_25_directions_1/output_images_python --save_uvw false --generate_images true --save_im true --save_as_csv true</div>
</div><!-- fragment --><div class="fragment"><div class="line">./build/RadioImager --input data/elements_25_directions_1/xyz_coordinates.csv --directions data/elements_25_directions_1/directions.csv --use_predefined_params true --image_dir data/elements_25_directions_1/output_images_gpu --save_images true</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md49"></a>
Converting CSV to PNG</h2>
<p>The <code><a class="el" href="convert__gpu__csv__to__png_8py.html">convert_gpu_csv_to_png.py</a></code> script converts CSV files containing image data to PNG format for easier visualization. This script can be executed with the following command:</p>
<div class="fragment"><div class="line">python3 python/convert_gpu_csv_to_png.py --input_csv data/elements_25_directions_1/output_images_gpu/image_data_gpu_0.csv --output_dir data/elements_25_directions_1/output_images_gpu/</div>
</div><!-- fragment --><p>These scripts can be modified to test different numbers of elements and configurations as needed. The <code>data</code> directory in the root of the repository contains examples of the output CSV and PNG files. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
